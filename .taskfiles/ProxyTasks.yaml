---
version: "3"

tasks:
  run:
    desc: Run mitm proxy with addon.
    cmds:
      - source {{.PROJECT_DIR}}/.venv/bin/activate && mitmdump -s mitmproxy_addon.py

  run:cli:
    desc: Run mitm proxy with addon.
    cmds:
      - source {{.PROJECT_DIR}}/.venv/bin/activate && mitmproxy -s mitmproxy_addon.py

  run:web:
    desc: Run mitm proxy with addon.
    cmds:
      - source {{.PROJECT_DIR}}/.venv/bin/activate && mitmweb -s mitmproxy_addon.py

  setup:
    desc: Set proxy settings.
    cmds:
      - networksetup -setwebproxy "{{.PROXY_TARGET}}" {{.PROXY_IP}} {{.PROXY_PORT}}
      - networksetup -setsecurewebproxy "{{.PROXY_TARGET}}" {{.PROXY_IP}} {{.PROXY_PORT}}
      - networksetup -setwebproxystate "{{.PROXY_TARGET}}" on
      - networksetup -setsecurewebproxystate "{{.PROXY_TARGET}}" on

  restore:
    desc: Restore proxy settings.
    cmds:
      - networksetup -setwebproxy "{{.PROXY_TARGET}}" {{.ORIG_PROXY_IP}} {{.ORIG_PROXY_PORT}}
      - networksetup -setsecurewebproxy "{{.PROXY_TARGET}}" {{.ORIG_SECURE_PROXY_IP}} {{.ORIG_SECURE_PROXY_PORT}}
      - networksetup -setwebproxystate "{{.PROXY_TARGET}}" off
      - networksetup -setsecurewebproxystate "{{.PROXY_TARGET}}" off

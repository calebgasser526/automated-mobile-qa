---
version: "3"

tasks:
  install:
    desc: Install all inital dependencies.
    cmds:
      - task: brew
      - task: precommit

  precommit:
    desc: Initalize pre-commit
    deps: [brew]
    cmds:
      - pre-commit install --install-hooks
    status:
      - test -f {{.PROJECT_DIR}}/.git/hooks/pre-commit
    preconditions:
      - command -v pre-commit

  brew:
    desc: Install dependencies with Brew
    cmds:
      - brew install {{.DEPS}} -q {{.CLI_ARGS}}
    preconditions:
      - sh: command -v brew
        msg: |
          Brew is not installed. Did you run the bootstrap script? "./hack/bootstrap.sh"
    vars:
      DEPS: >-
        wget
        jq
        lima
        pre-commit
        prettier
        yamllint
        go
    status:
      - command -v lima
      - command -v wget
      - command -v prettier
      - command -v pre-commit
      - command -v yamllint
      - command -v go
